<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#1a1a2e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Timestamp Cam">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <title>Timestamp Camera - Install</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="install-page">

  <div class="install-container">
    <!-- Branding -->
    <div class="install-hero">
      <div class="install-icon">
        <svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="80" height="80" rx="18" fill="#6c63ff"/>
          <circle cx="40" cy="36" r="14" stroke="#fff" stroke-width="3" fill="none"/>
          <circle cx="40" cy="36" r="6" fill="#fff"/>
          <rect x="16" y="20" width="48" height="32" rx="6" stroke="#fff" stroke-width="3" fill="none"/>
          <rect x="30" y="56" width="20" height="4" rx="2" fill="#ffa726"/>
          <text x="40" y="68" text-anchor="middle" fill="#ffa726" font-size="7" font-family="monospace">12:34:56</text>
        </svg>
      </div>
      <h1 class="install-title">Timestamp Camera</h1>
      <p class="install-subtitle">Take photos with real-time or custom timestamps burned right into the image.</p>
    </div>

    <!-- Install Button (Android Chrome native prompt) -->
    <button id="installBtn" class="btn btn-primary install-btn" style="display: none;">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
      Install App
    </button>

    <!-- Instructions -->
    <div class="install-instructions">
      <h2 class="instructions-heading">Add to Home Screen</h2>

      <!-- Android instructions -->
      <div id="androidInstructions" class="instruction-card">
        <div class="instruction-badge android-badge">Android</div>
        <ol class="instruction-steps">
          <li>
            <span class="step-icon">⋮</span>
            Tap the <strong>menu</strong> button (three dots) in Chrome
          </li>
          <li>
            <span class="step-icon">➕</span>
            Select <strong>"Add to Home Screen"</strong>
          </li>
          <li>
            <span class="step-icon">✓</span>
            Tap <strong>"Add"</strong> to confirm
          </li>
        </ol>
      </div>

      <!-- iOS instructions -->
      <div id="iosInstructions" class="instruction-card">
        <div class="instruction-badge ios-badge">iPhone / iPad</div>
        <ol class="instruction-steps">
          <li>
            <span class="step-icon">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>
            </span>
            Tap the <strong>Share</strong> button in Safari
          </li>
          <li>
            <span class="step-icon">➕</span>
            Scroll down and tap <strong>"Add to Home Screen"</strong>
          </li>
          <li>
            <span class="step-icon">✓</span>
            Tap <strong>"Add"</strong> in the top right
          </li>
        </ol>
      </div>
    </div>

    <!-- Continue to camera -->
    <a href="camera.html" class="btn btn-secondary continue-btn">
      Continue to Camera
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
    </a>
  </div>

  <script>
    // Redirect to camera if already installed (standalone mode)
    if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
      window.location.replace('camera.html');
    }

    // Platform detection — highlight relevant instructions
    (function () {
      const ua = navigator.userAgent || '';
      const isIOS = /iPad|iPhone|iPod/.test(ua) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
      const isAndroid = /Android/.test(ua);

      const androidCard = document.getElementById('androidInstructions');
      const iosCard = document.getElementById('iosInstructions');

      if (isIOS) {
        androidCard.classList.add('dimmed');
        iosCard.classList.add('highlighted');
      } else if (isAndroid) {
        iosCard.classList.add('dimmed');
        androidCard.classList.add('highlighted');
      }
      // If neither, show both equally
    })();

    // Handle native install prompt (Chrome on Android)
    let deferredPrompt = null;
    const installBtn = document.getElementById('installBtn');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = 'inline-flex';
    });

    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      const result = await deferredPrompt.userChoice;
      if (result.outcome === 'accepted') {
        installBtn.style.display = 'none';
      }
      deferredPrompt = null;
    });

    window.addEventListener('appinstalled', () => {
      installBtn.style.display = 'none';
    });

    // Register service worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(() => {});
    }
  </script>
</body>
</html>
